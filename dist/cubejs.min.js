/**
 * CubeJS 0.0.1
 * 2016-01-30, (c) 2016 FÃ¡bio Nogueira
 * Released under the MIT License.
 * Full source at https://github.com/fabionogueira/cubejs
*/
var CubeJS;!function(){function e(){}function r(e){var r;for(r in a)e=e.replace(/\$CELL\s*\([\w\W]*\)/g,function(e){var r=e.split("(");return"$f."+r[0].substring(1)+".apply($s,["+r[1].substring(0,r[1].length-1)+"])"});return Function("$r","$c","$f","$s","return "+e)}function i(e){function r(e,i,t){var n;if(d[i]||(d[i]=[]),d[i][t]=e,e.calculated){for(n=0;w>n;n++)m.data[n].splice(t-m.rows.levels,0,null);b++,C[e.id]=e}if(e.children){for(n=0;n<e.children.length;n++)t=r(e.children[n],i+1,t);return t}return _[e.id]=t,t+1}function i(e,r,t){var n;if(d[r]||(d[r]=[]),d[r][t]=e,e.calculated&&(m.data.splice(r-m.cols.levels,0,[]),w++,C[e.id]=e),e.children){for(n=0;n<e.children.length;n++)r=i(e.children[n],r,t+1);return r}return g[e.id]=r,r+1}function t(r){var i,t,n,l,s,c=g[r.id];for(n=d[c],i=0;b>i;i++)t=c-m.cols.levels,s=r.value(t,i,a,e),l=i+m.rows.levels,n[l]={value:s,calc:"row",summary:r.summary},m.data[t][i]={value:s,calc:"row"},o(n[l],e._definition.format)}function n(r){var i,t,n,l,s=_[r.id];for(i=0;w>i;i++)n=m.cols.levels+i,d[n]&&(t=s-m.rows.levels,l=r.value(i,t,a,e),d[n][s]={value:l,calc:"col",summary:r.summary},m.data[i][t]={value:l,calc:"col"},o(d[n][s],e._definition.format))}var l,s,c,u,f,p,d,h,v,m,y,_,g,w,b,C;for(d=e._matrix=[],m=e._cube,v=e._operations,_=e._mapCols,g=e._mapRows,b=m.data.collength,w=m.data.length,C={},u=m.rows.levels,l=0;l<m.cols.children.length;l++)u=r(m.cols.children[l],0,u);for(c=m.cols.levels,l=0;l<m.rows.children.length;l++)c=i(m.rows.children[l],c,0);for(c=0;c<m.data.length;c++)for(h=m.data[c],l=c+m.cols.levels,u=0;u<h.length;u++)y=h[u],s=u+m.rows.levels,d[l]&&(d[l][s]=h[u]),o(y,e._definition.format);for(l=0;l<v.length;l++)f=v[l],p=C[f.id],p&&("calculatedRow"===p.type?t(p):"calculatedCol"===p.type&&n(p));return d.colsLength=b+m.rows.levels,d.rowsLength=w+m.cols.levels,d}function t(e){var r,i;for(e._operations.sort(n),r=0;r<e._operations.length;r++)i=e._operations[r],s[i.type].init(e,i)}function n(e,r){return e.priority===r.priority?0:e.priority>r.priority?-1:1}function o(e,r){var i,t;e&&(i=e.value.toFixed(r.precision),t=i.split("."),i=t[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+r.thousand)+(t[1]?r.decimal+t[1]:""),e.label=r.prefix+i+r.suffix)}var l={},a={},s={};return CubeJS=function(n,o){var a,c;n.format={precision:2,prefix:"",suffix:"",decimal:".",thousand:","},c={_definition:n,_cube:o,_operations:[],_mapRows:{},_mapCols:{},_views:{},render:function(e,r){var i=this._views[r];return i&&(e="string"==typeof e?document.getElementById(e):e,i.apply(this,[e])),this},definition:function(){return this},cube:function(){},addOperation:function(i,t,n){var o,l=s[t];return l?(o={id:i,type:t,priority:l.priority,position:n.position||"after",reference:n.reference,label:n.label||i,value:n.expression?r(n.expression):e,summary:n.summary},this._operations.push(o),l.create(c,o)):console.error('Operation "'+t+'" not found.'),this},removeOperation:function(e){var r;for(r=0;r<this._operations.length;r++)if(this._operations[r].id===e){this._operations.splice(r,1);break}return this},process:function(){return t(this),i(this),this}};for(a in l)l[a].apply(c);return n&&c.definition(n),o&&c.cube(o),c},CubeJS.plugin=function(e,r){return l[e]=r,this},CubeJS.createFunction=function(e,r){return a[e]=r,this},CubeJS.createOperation=function(r,i){return i.priority=i.priority||100,i.create=i.create||e,i.init=i.init||e,s[r]=i,this},CubeJS}();