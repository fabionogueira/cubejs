/**
 * CubeJS Plugins 0.0.1
 * 2016-01-30, (c) 2016 FÃ¡bio Nogueira
 * Released under the MIT License.
 * Full source at https://github.com/fabionogueira/cubejs
*/
!function(){function e(e){var t,l=0,i=0;for(t in e)"measure"!==e[t].type?i++:l=1;return i+l}function t(t,l){function i(e,l,u,s,d){var _,b,v,g,p,C,y;for(s.children=s.children||[],C=l.buckets,_=0;_<C.length;_++){p=!1,g=C[_],v=u+g.key,y=o(s.children,{id:v,label:g.key_as_string||g.key,category:g.key,dimension:e});for(b in g)t.cols[b]?(p=!0,"measure"!==t.cols[b].type&&g[b].buckets?i(b,g[b],v+"$",y,d):a(b,g[b],y,h[v].x)):t.rows[b]&&(p=!0,"measure"!==t.rows[b].type&&g[b].buckets?n(b,g[b],"",y,d):c(b,g[b],d,h[v].x));p||r(g,h[v].x,f[d.id].y)}}function n(e,l,o,s,d){var _,b,v,g,p,C,y;for(d.children=d.children||[],C=l.buckets,_=0;_<C.length;_++){p=!1,g=C[_],v=o+g.key,y=u(d.children,{id:v,label:g.key_as_string||g.key,category:g.key,dimension:e});for(b in g)t.cols[b]?(p=!0,"measure"!==t.cols[b].type&&g[b].buckets?i(b,g[b],"",s,y):a(b,g[b],s,f[v].y)):t.rows[b]&&(p=!0,"measure"!==t.rows[b].type&&g[b].buckets?n(b,g[b],v+"$",s,y):c(b,g[b],y,h[s.id].x));p||r(g,h[s.id].x,f[v].y)}}function a(e,t,l,i){var n,a,c;l.children=l.children||[],c=(l.id?l.id+"$":"")+e,n=o(l.children,{id:c,label:e,measure:e}),a=h[c].x,s.data[i]=s.data[i]||[],s.data[i][a]={value:t.value},s.data.collength<s.data[i].length&&(s.data.collength=s.data[i].length)}function c(e,t,l,i){var n,a,c;l.children=l.children||[],c=(l.id?l.id+"$":"")+e,n=u(l.children,{id:c,label:e,measure:e}),a=f[c].y,s.data[a]=s.data[a]||[],s.data[a][i]={value:t.value},s.data.collength<s.data[a].length&&(s.data.collength=s.data[a].length)}function r(e,t,l){s.data[l]=s.data[l]||[],s.data[l][t]={value:e.doc_count},s.data.collength<s.data[l].length&&(s.data.collength=s.data[l].length)}function o(e,t){return h[t.id]||(e.push(t),e.length>1&&_++,h[t.id]={item:t,x:_},s.data.collength=_),h[t.id].item}function u(e,t){return f[t.id]||(e.push(t),e.length>1&&b++,f[t.id]={item:t,y:b}),f[t.id].item}var s,d,h={},f={},_=0,b=0;s={cols:{levels:e(t.cols)},rows:{levels:e(t.rows)},data:[]},s.data.collength=0;for(d in l){(t.cols[d]?i:n)(d,l[d],"",s.cols,s.rows);break}return s}CubeJS.plugin("es",function(){this.definition=function(e){return this._definition=e,this.cube(this._cube)},this.cube=function(e){return 0===arguments.length?this._cube:(e&&this._definition&&!e.__es__&&(this._cube=t(this._definition,e.aggregations),e.__es__=!0),this)},this.query=function(){return this._definition?"":void 0}})}(),function(){function e(t,l,i,n){var a,c;if(l.id===t.reference&&(c={calculated:!0,type:t.type,id:t.id,label:t.label,position:t.position,value:t.value},"after"===t.position?i.splice(++n,0,c):i.splice(n++,0,c)),l.children)for(a=0;a<l.children.length;a++)a=e(t,l.children[a],l.children,a);return n}function t(e,t){var l,i,n,a=0,c=arguments[3]._cube.data;for(i=c[e],l=0;l<i.length;l++)n=i[l],n&&t!==l&&(a+=n.value);return a}function l(e,t){var l,i,n=0,a=arguments[3]._cube.data;for(l=0;l<a.length;l++)i=a[l][t],i&&e!==l&&(n+=i.value);return n}CubeJS.createOperation("calculatedRow",{init:function(t,l){var i,n=t._cube;for(i=0;i<n.rows.children.length;i++)i=e(l,n.rows.children[i],n.rows.children,i)}}).createOperation("calculatedCol",{init:function(t,l){var i,n=t._cube;for(i=0;i<n.cols.children.length;i++)i=e(l,n.cols.children[i],n.cols.children,i)}}).createOperation("totalCol",{priority:20,init:function(e,l){var i,n=e._cube;i={calculated:!0,type:"calculatedCol",id:l.id,label:l.label,position:l.position,value:t,summary:!0},n.cols.children.push(i)}}).createOperation("totalRow",{priority:20,init:function(e,t){var i,n=e._cube;i={calculated:!0,type:"calculatedRow",id:t.id,label:t.label,position:t.position,value:l,summary:!0},n.rows.children.push(i)}})}(),function(){CubeJS.createFunction("CELL",function(e,t){var l,i,n=this._mapCols,a=this._mapRows;return"string"==typeof e&&(e=a[e]-this._cube.cols.levels),"string"==typeof t&&(t=n[t]-this._cube.rows.levels),l=this._cube.data[e],i=l?l[t]:null,i?i.value:null}).createFunction("SUMMARY_ROW",function(e,t){if(void 0===this.$CACHE_ROWSUM[e]&&(this.$CACHE_ROWSUM[e]={},this.$CACHE_ROW_MEASURE[e]={},this.$CACHE_ROW_PERCENT[e]={}),void 0===this.$CACHE_ROWSUM[e][t]){for(var l,i=0,n=0,a=this._cube.cols.levels;e>a;a++)l=this.MT[a][t],l&&(i+=l.value,n++);this.$CACHE_ROWSUM[e][t]=i,this.$CACHE_ROW_MEASURE[e][t]=1*(i/n).toFixed(2),this.$CACHE_ROW_PERCENT[e][t]="TODO"}return this.$CACHE_ROWSUM[e][t]}).createFunction("MEASURE_ROW",function(e,t){return this.SUMMARY_ROW(e,t),this.$CACHE_ROW_MEASURE[e][t]}).createFunction("PERCENT_ROW",function(e,t){return this.SUMMARY_ROW(e,t),this.$CACHE_ROW_PERCENT[e][t]})}(),function(){function e(e){e.innerHTML=t(this)}function t(e){function t(e,t,l){var i,n="";return i=e>c.cols.levels-1?t>c.rows.levels-1?"cell value":"cell label label-row":t>c.rows.levels-1?"cell label label-col":"cell",l&&(i+=l.calculated?" calc-"+l.calc+" label-calc":"",i+=l.calc?" calc-"+l.calc+" value-calc":""),n=l?l.label||l.value:null,'<td class="'+i+'">'+(null===n||void 0===n?"":n)+"</td>"}var l,i,n,a,c=e._cube,r=e._matrix;for(a='<table class="table" border="0" cellpadding="3" cellspacing="0">',l=0;l<r.rowsLength;l++){for(n=r[l],a+="<tr>",i=0;i<r.colsLength;i++)a+=t(l,i,n[i]);a+="</tr>"}return a+="</table>","<pre>"+a+"</pre>"}CubeJS.plugin("htmlTable",function(){this.htmlTable=function(){return t(this)},this._views.table=e})}();